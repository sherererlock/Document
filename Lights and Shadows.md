## Lights and Shadows

光是电磁辐射的一个可见部分，但在这篇文章中，我不打算讨论任何潜在的细节，如波粒二象性。相反，我将尝试解释光是如何创造出日常生活中看到的许多美丽效果的。在下面的演示中，你可以使用滑块来控制一个矩形光源的位置和大小。你还可以在场景中拖动，从不同的角度看它。

在本文结束时，这个演示中的光线效果应该变得更加清晰，但在这之前，我们必须退后几步，从一个更简单的设置开始。

#### Power（Radiant flux）

让我们首先引入一个单一的球形光源。虽然这个光球不是很有趣，但你至少可以用下面的滑块控制它的亮度。

这个滑块实际上调节的是光源的功率--每秒钟从它发出的能量。这种能量以光子的形式出现，我们可以粗略地用从光源出来的光线来表示。功率越大，在单位时间内从光源发出的光线就越多。

不幸的是，这种示范是相当有限的。即使是一个简单的灯泡，每秒钟发出的光子数量也是绝对巨大的，而且没有固定的光子传播方向。尽管如此，光线的比喻对于解释相当多的现象是有用的，因此尽管它有缺陷，但它将作为一个宝贵的工具为我们服务。

光源的功率是用瓦特W这个单位来衡量的。让我们看看我们是如何根据一些光源的功率来感知其亮度的。

请注意，感知到的亮度的相对变化强烈地取决于滑块的位置。从5W到10W的变化比从85W到90W的变化更容易被感觉到。人类的视觉系统对入射光线的功率有一个非线性的反应，所以固定的功率增加不会有一个固定的感知亮度增加。

此外，光线本身的亮度很快就会饱和为纯白色。我们达到了网络技术容易呈现的极限。有一些方法可以缓解这个问题，但在这篇文章中，我想呈现未经修改的亮度水平，因为这使得相对比较成为可能。

尽管有白色的饱和度，一旦我们把哑光表面放在亮光旁边，我们就可以很容易地观察到增加功率的效果。你可以在演示中拖动，从不同的角度看这个场景。

虽然表面本身不会发出任何光，但它会反射从光源发出的光。部分反射光会直接进入我们的眼睛，使我们能够看到这个物体。当然，表面的另一面是漆黑的--由于被正面挡住了，所以没有光线进入它。

提到这些概念可能看起来微不足道，但反射光和阻挡光最终将定义我在本文中讨论的几乎所有内容。

#### Position

如果你仔细看了前面的模拟，你可能已经注意到，表面的光线并不均匀。让我们通过移动灯光来研究这种阴影的变化。在下面的演示中，你可以控制它的高度角和距离。

即使是这个简单的例子，我们也可以观察到，光的位置角度和它与被照物体的距离都会对哑光表面的外观产生影响。我们可以尝试通过可视化光源发出的光线来了解发生了什么。为了使事情更容易看清，只有击中表面的光线被画成全长。

改变光线的位置可以改变照射到表面的光线数量，从而影响到表面的外观。请注意，表面的不同部分得到不同数量的光线，所以让我们分离出一个小区域，近距离观察。

首先，我们来分析一下高度角的影响。在下面的模拟中，一个红点终止了一条射线，在垂直的情况下，这条射线曾经击中了这个小斑块，但是倾斜之后，它不再这样做了。

一旦光源从垂直方向上倾斜，一些过去打到贴片上的光线就不再打到了。从侧面看，我们可以更清楚地看到这种情况。蓝色箭头表示表面法线。与二维的情况类似，三维的法线方向是局部垂直于表面的。黄色箭头指向光源。

随着角度的增加，原始光流中较小的部分击中表面。**在光源的功率P下**，**单位面积的接收功率E被称为辐照度**，**击中面积为A的表面小块的辐照度与对光方向和小块法向量之间的入射角α的余弦成正比**。
$$
E = \frac {P cos(\alpha)} {A}
$$
对于一个有小而远的光源的平坦的哑光表面，这个余弦因子的着色结果并不特别令人兴奋，因为表面的每一个点看起来几乎都一样。然而，当表面的每个元素都有不同的入射角时，就像球体的情况一样，哑光表面的阴影看起来相当漂亮。在下面的例子中，黄色箭头显示的是朝向远处光源的方向。

有了余弦因子，我们现在可以分析与光源的距离如何影响光线的分布。然而，红点再次显示了曾经击中补丁的光线的交叉点，但由于光线的距离增加，它们不再这样做。

光线越远，打在表面上的光子就越少。对于这样一个微小的光源，我们可以用几何学的推理来量化这种关系。在下面的演示中，你可以看到从一个小光源向各个方向发射的光线。该光源被一个球体所包围--你可以用滑块控制其半径。

注意，当球体的半径增加时，黄色交点的密度就会下降。虽然射线的数量是恒定的，但表面的总面积增加了，局部的光照强度也更加稀薄。球体的面积与它的半径r的平方成正比。
$$
A = 4\pi r^2
$$
因此，每单位面积的接收功率E，在固定功率下，与距离r的平方的倒数成正比。
$$
E = \frac{p}{A}\approx\frac{1}{r^2}
$$


这个规则被称为反平方定律，它只对无限小的光源准确地成立，而这些光源在物理世界中是不存在的。因此，这个简化的假设不能让我们解释即使是一个简单的矩形光源所得到的各种阴影。

为了理解这里发生的事情，我们需要改变一下节奏，讨论一下角度和 fields of views.。

#### Angles

如果你曾经看过一辆正在驶离的汽车，你很可能注意到，当它驶离时，它似乎变小了。在下面的演示中，我们可以通过控制汽车的位置来重现这种情况。上面的部分显示了该场景的自上而下的视图，而下面的部分显示了如果你站在红点上，你的眼睛会如何看待它。

红点周围的灰色圆圈象征着一个完整的周围视野。随着汽车的移动，它在该视野中的角度，如黄色弧线所示，变得更小，因此汽车看起来更小。

**Radians**

汽车模拟显示的角度使用的是度的单位，但观察到黄色弧线的长度也随着角度的变小而变小。在数学中，通常用**弧线的长度与该弧线所跨越的圆的半径之比**来测量角度。
$$
angle = \frac{arc length} {radius}
$$
角度的量度是以弧度表示的。你可以在下面的演示中看到度和弧度的关系。

当一个角度测量为1弧度时，黄色弧线的长度就等于蓝色半径的长度。一个圆的周长等于半径的2π倍，所以半圈的量度只是π弧度。

与度数类似，弧度的测量也与圆的半径完全无关。圆的周长与半径的比值总是等于2π，而弧长与弧的半径的比值只是2π的某个分数。

作为本节的最后一个考虑因素，让我们研究一下，当物体在视野中已经很小，并且远离观察者时，被摄角度和弧长会发生什么变化。

请注意，黄色的弧线是非常平坦的，在这种情况下，当物体移动到两倍远的地方时，它所承受的角度就会变得相当小，是两倍。当我们把弧线看成是一条直线段时，这是由相似三角形的基本比例得出的。当弧线变短时，这种近似变得更加准确，因为曲率变得更加可以忽略不计。

#### Solid Angles

在汽车的例子中，我很方便地只关注了汽车的感知宽度，但你可能已经注意到，远处的车辆似乎也变短了。人类的视觉并不仅仅局限于水平方向，所以让我们尝试通过将这个例子扩展到第三维来模拟我们的视野。这一次，为了不让自己进行三维建模练习，我将使用一个简单的矩形。

请注意，随着长方形的远离，球体上的投影面积越来越小。这就完成了对为什么物体在远处时看起来比较小的解释--它们只是占据了我们视野中较小的部分。

在二维空间中，我们将角度定义为一个圆的弧长与该圆的半径之比。在三维空间中，我们同样将立体角定义为一个球体上被遮挡部分的**面积与该球体半径的平方之比**。
$$
solid angle = \frac{patch area} {radius^2}
$$
补丁的形状可以是完全任意的，重要的是它的面积。在下面的演示中，你可以看到一些实心角，这些立体角的测量单位是立体度。我强调了到达贴片的圆锥体，以使事情更加明显，但最终它只是定义了实体角的黄色区域。

由于球体的面积是半径的4π倍，最大的实体角是4π立体角。请注意，弧度和立体角都是无量纲的，我们只是给它们起了个方便的名字，以确认我们是在讨论角度问题。

最后，让我们看看当物体移动时，一个小的实体角会发生什么。

当长方形的投影足够小的时候，半球上的弧形斑块就可以用一块平坦的东西来近似。由于投影的宽度和高度都与距离成反比，所以**贴片的面积随着距离的平方而缩小**，在某种意义上说，从观察者的角度来看，再现了反平方律。

#### Surface Vision

让我们试着把视场和实体角的概念映射到前一个场景的表面。

表面的每一个点都暴露在环境中，但一个点只能通过以它为中心的半球形看到周围的环境。球体的另一半只是被表面本身挡住了--没有光线可以从它下面到达。如果我们现在把光放在场景中，并试图把它投射到半球形上，我们可以观察到投射区域的情况。我让地板的背面看起来是透明的，让你从里面看到半球体。

面积越小，光源的实体角就越小，因此到达表面的光量就越小。然而，我们仍然没有考虑到余弦因素--靠近地平线的实体角的影响应该较小。

事实证明，我们可以通过采用一个简单的技巧来解决这个问题，即把半球上的被摄角的轮廓投射到基地上。

这个过程自动考虑了余弦因子--注意，当光源接近地平线时，表面上的投影黄色区域会变小。这种投射实角的方法解释了在均匀光源照射下，哑光表面上的一个点会显得多么明亮。

#### Radiance

到目前为止，我向你展示的东西可能看起来很合理，但你可能会对一些不一致的地方感到疑惑。正如我们所看到的，哑光表面在远离光线的时候会变得更暗，而且当光线的高度角偏离垂直方向时也会变暗。

然而，光源本身似乎并没有受到同样的影响--即使我们从一个倾斜的角度看它，或者用滑块移开它，它仍然保持一贯的明亮。

哑光的表面似乎从各个方向收集周围的光线。人眼和数码相机的工作方式完全不同。通过光学系统，视网膜上的每个感受器，或相机中的每个像素，只从一个非常小的实体角度收集光线。在下面的演示中，左边的一个微小的蓝色受体只暴露在黄色锥体 "看到 "的光线中。

随着光源的远离，到达受体的功率会以距离的平方的倒数减少。然而，在同一时间，实心角可见的光的表面量以距离的平方增加--你可以观察到右下角的圆锥体底部。这两种效应相互抵消，感知的亮度保持不变。

像这样的感受器测量的是Radiance，即单位面积和单位实体角的功率。感受器的大小和它接收光线的实体角度都有助于收集能量的数量。

当光被人看到时，我们通常使用[*luminance*](https://en.wikipedia.org/wiki/Luminance)这个术语，它只是由人类视觉系统的波长敏感功能加权的辐射度。[*luminance*](https://en.wikipedia.org/wiki/Luminance)定义了一个物体对我们的眼睛来说有多亮，它以nit表示--你可能听说过这个术语指的是显示器的亮度。

光源的视角独立性只适用于所谓的兰伯斯发射器，然而，许多典型的光源，如磨砂灯泡和太阳，都是这些理想化发生器的近似值。

兰伯斯发射器的每一个点都以下列球形模式发射光，箭头的长度对应于在箭头方向上每秒发射的光子的相对数量。

矢量的长度与远离法线的角度的余弦成正比，最终形成一个完美的球体。为了了解这种分布是如何影响总亮度的，让我们看看观察者从侧面看是如何感知光的表面的。

黄色的形状代表一个稳固的角度，受体从这个角度接收光线，只有直接向其方向发射的光子才能到达。

随着观察角度的倾斜，每个箭头的长度会变小，所以表面的每个点对观察者贡献的光子会减少。然而，与此同时，受体看到的是更大块的表面。更短的箭头的效果被更多的箭头看到所抵消了。

由于箭头的长度与角度的余弦成正比，而可见面积与同一角度的余弦成反比，所以总的感知亮度保持不变.

https://ciechanow.ski/lights-and-shadows/

